<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Voice Search Popup</title>
</head>
<body>
  <button onclick="startVoice()">üé§ B·∫•m ƒë·ªÉ n√≥i</button>
  <p id="result">K·∫øt qu·∫£: ...</p>

  <script>
    function startVoice() {
      try {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = "vi-VN";
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onresult = function(event) {
          const transcript = event.results[0][0].transcript;
          document.getElementById("result").innerText = "K·∫øt qu·∫£: " + transcript;

          // G·ª≠i k·∫øt qu·∫£ v·ªÅ Axure
          if (window.opener) {
            window.opener.postMessage(transcript, "*");
          }

          // T·ª± ƒë·ªông ƒë√≥ng popup sau 1 gi√¢y
          setTimeout(() => window.close(), 1000);
        };

        recognition.onerror = function(event) {
          if (event.error === "not-allowed") {
            alert("Tr√¨nh duy·ªát kh√¥ng cho ph√©p truy c·∫≠p micro. H√£y ki·ªÉm tra quy·ªÅn trong ph·∫ßn c√†i ƒë·∫∑t.");
          } else {
            alert("L·ªói: " + event.error);
          }
        };

        recognition.start();
      } catch (e) {
        alert("Kh√¥ng th·ªÉ kh·ªüi ƒë·ªông ghi √¢m: " + e.message);
      }
    }
  </script>
</body>
</html>
